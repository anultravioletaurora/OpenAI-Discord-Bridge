FROM node:18-alpine

LABEL org.cosmonautical.discord-gpt.authors="support@cosmonautical.cloud"

RUN apk add --no-cache --update curl ca-certificates openssl git tar bash sqlite fontconfig sudo \
    && adduser --disabled-password --home /home/container container

# Add container user to sudo group
RUN sudo addgroup container sudo
RUN echo '%sudo ALL=(ALL) NOPASSWD:ALL' >> /etc/sudoers

# Create container user
USER container
ENV USER=container HOME=/home/container

# Create app directory
WORKDIR /home/container

# Install app dependencies
COPY ../package*.json ./
RUN sudo npm install

# Bundle app source
COPY ../dist .

# Copy entrypoint script
COPY ./pterodactyl/entrypoint.sh /entrypoint.sh

CMD [ "/bin/bash", "/entrypoint.sh" ]
